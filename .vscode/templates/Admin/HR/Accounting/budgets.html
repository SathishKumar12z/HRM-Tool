{% include "Layout/top.html" %}
{% include "Layout/side.html" %}

<!-- Page Wrapper -->
<div class="page-wrapper">
	<!-- Page Content -->
	<div class="content container-fluid">
		<!-- Page Header -->
		<div class="page-header">
			<div class="row align-items-center">
				<div class="col">
					<h3 class="page-title">Budgets</h3>
					<ul class="breadcrumb">
						<li class="breadcrumb-item"><a href="admin-dashboard.html">Dashboard</a></li>
						<li class="breadcrumb-item active">Accounts</li>
					</ul>
				</div>
				<div class="col-auto float-end ms-auto">
					<a href="#" class="btn add-btn" data-bs-toggle="modal" data-bs-target="#add_categories"><i
							class="fa-solid fa-plus"></i> Add Budgets</a>
				</div>
			</div>
		</div>
		<!-- /Page Header -->

		<div class="row">
			<div class="col-md-12">
				<div class="table-responsive">
					<table class="table table-striped custom-table mb-0">
						<thead>
							<tr>
								<th>Budget No</th>
								<th>Budget Title</th>
								<th>Budget Type</th>
								<th>Start Date</th>
								<th>End Date</th>
								<th>Total Revenue</th>
								<th>Total Expenses</th>
								<th>Tax Amount</th>
								<th>Budget Amount</th>
								<th class="text-end">Action</th>
							</tr>
						</thead>
						<tbody>
							{% for i in budget_data %}
							<tr>
								<td>{{loop.index}}</td>
								<td>{{i.Budget_Title}}</td>
								<td>{{i.Budget_Type}}</td>
								<td>{{i.Start_Date}}</td>
								<td>{{i.End_Date}}</td>
								<td>{{i.Overall_Revenues}}</td>
								<td>{{i.Overall_Expense}}</td>
								<td>{{i.Tax}}</td>
								<td>{{i.Budget_Amount}}</td>
								<td class="text-end">
									<div class="dropdown dropdown-action">
										<a href="#" class="action-icon dropdown-toggle" data-bs-toggle="dropdown"
											aria-expanded="false"><i class="material-icons">more_vert</i></a>
										<div class="dropdown-menu dropdown-menu-right">
											<a class="dropdown-item" href="#" data-bs-toggle="modal"
												data-bs-target="#edit_categories" onClick="edit_modal('{{i.id}}')"><i
													class="fa-solid fa-pencil m-r-5"></i> Edit</a>
											<a class="dropdown-item" href="#" data-bs-toggle="modal"
												data-bs-target="#delete" onClick="delete_budget('{{i.id}}')"><i
													class="fa-regular fa-trash-can m-r-5"></i> Delete</a>
										</div>
									</div>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
	<!-- /Page Content -->

	<!-- Add Modal -->
	<div class="modal custom-modal fade" id="add_categories" role="dialog">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Add Budget</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form action="/submit_budget" method="POST">
						<div class="input-block mb-3">
							<label class="col-form-label">Budget Title</label>
							<input class="form-control" type="text" name="budget_title" id="budget_title"
								placeholder="Budgets Title">
						</div>

						<label class="col-form-label">Choose Budget Respect Type</label>
						<div class="input-block mb-3">
							<div class="form-check form-check-inline">
								<input class="form-check-input BudgetType" type="radio" name="budget_type"
									id="budget_type" value="project">
								<label class="form-check-label" for="project2">Project</label>
							</div>
							<div class="form-check form-check-inline">
								<input class="form-check-input BudgetType" type="radio" name="budget_type"
									id="budget_type" value="category">
								<label class="form-check-label" for="category1">Category</label>
							</div>

						</div>

						<div class="input-block mb-3">
							<label class="col-form-label">Start Date</label>
							<div class="cal-icon"><input class="form-control datetimepicker" type="text"
									name="budget_start_date" id="budget_start_date" placeholder="Start Date"
									data-date-format="dd-mm-yyyy"></div>
						</div>
						<div class="input-block mb-3">
							<label class="col-form-label">End Date</label>
							<div class="cal-icon"><input class="form-control datetimepicker" type="text"
									name="budget_end_date" id="budget_end_date" placeholder="End Date"
									data-date-format="dd-mm-yyyy"></div>
						</div>

						<div class="input-block mb-3">
							<label class="col-form-label">Expected Revenues</label>
						</div>
						<div class="AllRevenuesClass">
							<div class="row AlLRevenues">
								<div class="col-sm-6">
									<div class="input-block mb-3">
										<label class="col-form-label">Revenue Title <span
												class="text-danger">*</span></label>
										<input type="text" class="form-control RevenuETitle" value=""
											placeholder="Revenue Title" name="revenue_title" id="revenue_title "
											autocomplete="off">
									</div>
								</div>
								<div class="col-sm-5">
									<div class="input-block mb-3">
										<label class="col-form-label">Revenue Amount <span
												class="text-danger">*</span></label>
										<input type="text" name="revenue_amount" id="revenue_amount"
											placeholder="Amount" value="" class="form-control RevenuEAmount"
											autocomplete="off" onkeyup="calculate_revenve(this)">
									</div>
								</div>
								<div class="col-sm-1">
									<div class="add-more">
										<a class="add_more_revenue" title="Add Revenue"><i
												class="fa-solid fa-plus-circle"></i></a>
									</div>
								</div>
							</div>
						</div>

						<div class="input-block mb-3">
							<label class="col-form-label">Overall Revenues <span class="text-danger">(A)</span></label>
							<input class="form-control" type="text" name="total_revenve" id="total_revenve"
								placeholder="Overall Revenues" readonly>
						</div>
						<div class="input-block mb-3">
							<label class="col-form-label">Expected Expenses</label>
						</div>
						<div class="AllExpensesClass">
							<div class="row AlLExpenses">
								<div class="col-sm-6">
									<div class="input-block mb-3">
										<label class="col-form-label">Expenses Title <span
												class="text-danger">*</span></label>
										<input type="text" class="form-control EXpensesTItle" value=""
											id="expenses_title" placeholder="Expenses Title" name="expenses_title"
											autocomplete="off">
									</div>
								</div>
								<div class="col-sm-5">
									<div class="input-block mb-3">
										<label class="col-form-label">Expenses Amount <span
												class="text-danger">*</span></label>
										<input type="text" name="expenses_amount" id="expenses_amount"
											placeholder="Amount" value="" class="form-control EXpensesAmount"
											autocomplete="off" onkeyup="calculate_expense(this)">
									</div>
								</div>
								<div class="col-sm-1">
									<div class="add-more">
										<a class="add_more_expenses" title="Add Expenses"><i
												class="fa-solid fa-plus-circle"></i></a>
									</div>
								</div>
							</div>
						</div>

						<div class="input-block mb-3">
							<label class="col-form-label">Overall Expense <span class="text-danger">(B)</span></label>
							<input class="form-control" type="text" name="total_expense" id="total_expense"
								placeholder="Overall Expenses" readonly>
						</div>


						<div class="input-block mb-3">
							<label class="col-form-label">Expected Profit <span class="text-danger">( C = A - B )</span>
							</label>
							<input class="form-control" type="text" name="total_profit" id="total_profit"
								placeholder="Expected Profit" readonly>
						</div>

						<div class="input-block mb-3">
							<label class="col-form-label">Tax <span class="text-danger">(D)</span></label>
							<input class="form-control" type="text" name="tax_amount" id="tax_amount"
								placeholder="Tax Amount" onkeyup="calculate_amount(this)">
						</div>

						<div class="input-block mb-3">
							<label class="col-form-label">Budget Amount <span class="text-danger">( E = C - D )</span>
							</label>
							<input class="form-control" type="text" name="budget_amount" id="budget_amount"
								placeholder="Budget Amount" readonly>
						</div>
						<div class=" submit-section">
							<button class="btn btn-primary submit-btn">Submit</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<!-- /Add Modal -->

	<script>
		function calculate_revenve(data) {
			$('#total_revenve').val(data.value)
		}
		function calculate_expense(data) {
			$('#total_expense').val(data.value)
			$('#total_profit').val(Number($('#total_revenve').val()) - Number(data.value))

		}
		function calculate_amount(data) {
			$('#tax_amount').val(data.value)
			$('#budget_amount').val(Number($('#total_profit').val()) - Number(data.value))

		}
	</script>

	<!-- Edit Modal -->
	<div class="modal custom-modal fade" id="edit_categories" role="dialog">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Edit Budget</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form action="/budget_edit" method="POST">
						<div class="input-block mb-3">
							<input id="edit_id" name="edit_id" type="" />
							<label class="col-form-label">Budget Title</label>
							<input class="form-control" type="text" name="edit_budget_title" id="edit_budget_title"
								placeholder="Budgets Title">
						</div>

						<label class="col-form-label">Choose Budget Respect Type</label>
						<div class="input-block mb-3">
							<div class="form-check form-check-inline">
								<input class="form-check-input BudgetType" type="radio" name="edit_budget_type"
									id="edit_project" value="project">
								<label class="form-check-label" for="edit_project">Project</label>
							</div>
							<div class="form-check form-check-inline">
								<input class="form-check-input BudgetType" type="radio" name="edit_budget_type"
									id="edit_category" value="category">
								<label class="form-check-label" for="edit_category">Category</label>
							</div>

						</div>

						<div class="input-block mb-3">
							<label class="col-form-label">Start Date</label>
							<div class="cal-icon"><input class="form-control datetimepicker" type="text"
									name="edit_budget_start_date" id="edit_budget_start_date" placeholder="Start Date"
									data-date-format="dd-mm-yyyy"></div>
						</div>
						<div class="input-block mb-3">
							<label class="col-form-label">End Date</label>
							<div class="cal-icon"><input class="form-control datetimepicker" type="text"
									name="edit_budget_end_date" id="edit_budget_end_date" placeholder="End Date"
									data-date-format="dd-mm-yyyy"></div>
						</div>

						<div class="input-block mb-3">
							<label class="col-form-label">Expected Revenues</label>
						</div>
						<div class="AllRevenuesClass">
							<div class="row AlLRevenues">
								<div class="col-sm-6">
									<div class="input-block mb-3">
										<label class="col-form-label">Revenue Title <span
												class="text-danger">*</span></label>
										<input type="text" class="form-control RevenuETitle" value=""
											id="edit_revenue_title" placeholder="Revenue Title"
											name="edit_revenue_title" autocomplete="off">
									</div>
								</div>
								<div class="col-sm-5">
									<div class="input-block mb-3">
										<label class="col-form-label">Revenue Amount <span
												class="text-danger">*</span></label>
										<input type="text" name="edit_revenue_amount" placeholder="Amount" value=""
											id="edit_revenue_amount" class="form-control RevenuEAmount"
											autocomplete="off" onkeyup="calculate_Revenve(this)">
									</div>
								</div>
								<div class="col-sm-1">
									<div class="add-more">
										<a class="add_more_revenue" title="Add Revenue"><i
												class="fa-solid fa-plus-circle"></i></a>
									</div>
								</div>
							</div>
						</div>

						<div class="input-block mb-3">
							<label class="col-form-label">Overall Revenues <span class="text-danger">(A)</span></label>
							<input class="form-control" type="text" name="edit_total_revenve" id="edit_total_revenve"
								placeholder="Overall Revenues" readonly>
						</div>

						<div class="input-block mb-3">
							<label class="col-form-label">Expected Expenses</label>
						</div>
						<div class="AllExpensesClass">
							<div class="row AlLExpenses">
								<div class="col-sm-6">
									<div class="input-block mb-3">
										<label class="col-form-label">Expenses Title <span
												class="text-danger">*</span></label>
										<input type="text" class="form-control EXpensesTItle" value=""
											id="edit_expenses_title" placeholder="Expenses Title"
											name="edit_expenses_title" autocomplete="off">
									</div>
								</div>
								<div class="col-sm-5">
									<div class="input-block mb-3">
										<label class="col-form-label">Expenses Amount <span
												class="text-danger">*</span></label>
										<input type="text" name="edit_expenses_amount" placeholder="Amount"
											id="edit_expenses_amount" value="" class="form-control EXpensesAmount"
											autocomplete="off" onkeyup="calculate_Expense(this)">
									</div>
								</div>
								<div class="col-sm-1">
									<div class="add-more">
										<a class="add_more_expenses" title="Add Expenses"><i
												class="fa-solid fa-plus-circle"></i></a>
									</div>
								</div>
							</div>
						</div>

						<div class="input-block mb-3">
							<label class="col-form-label">Overall Expense <span class="text-danger">(B)</span></label>
							<input class="form-control" type="text" name="edit_total_expense" id="edit_total_expense"
								placeholder="Overall Expenses" readonly>
						</div>


						<div class="input-block mb-3">
							<label class="col-form-label">Expected Profit <span class="text-danger">( C = A - B )</span>
							</label>
							<input class="form-control" type="text" name="edit_total_profit" id="edit_total_profit"
								placeholder="Expected Profit" readonly>
						</div>

						<div class="input-block mb-3">
							<label class="col-form-label">Tax <span class="text-danger">(D)</span></label>
							<input class="form-control" type="text" name="edit_tax_amount" id="edit_tax_amount"
								placeholder="Tax Amount" onkeyup="calculate_Amount(this)">
						</div>

						<div class="input-block mb-3">
							<label class="col-form-label">Budget Amount <span class="text-danger">( E = C - D )</span>
							</label>
							<input class="form-control" type="text" name="edit_budget_amount" id="edit_budget_amount"
								placeholder="Budget Amount" readonly>
						</div>
						<div class="submit-section">
							<button class="btn btn-primary submit-btn">Submit</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<script>
		function edit_modal(data) {
			$.get('/taking_edit_modal/' + data, function (res) {
				console.log(res)

				$('#edit_id').val(res.id)
				$('#edit_budget_title').val(res.Budget_Title)
				// $('#edit_budget_type').val(res.Budget_Type)
				$('#edit_budget_start_date').val(res.Start_Date)
				$('#edit_budget_end_date').val(res.End_Date)
				$('#edit_revenue_title').val(res.Revenue_Title)
				$('#edit_revenue_amount').val(res.Revenue_Amount)
				$('#edit_total_revenve').val(res.Overall_Revenues)
				$('#edit_expenses_title').val(res.Expenses_Title)
				$('#edit_expenses_amount').val(res.Expenses_Amount)
				$('#edit_total_expense').val(res.Overall_Expense)
				$('#edit_total_profit').val(res.Expected_Profit)
				$('#edit_tax_amount').val(res.Tax)
				$('#edit_budget_amount').val(res.Budget_Amount)
				if (res.Budget_Type == 'project') {
					$('#edit_project').attr('checked', 'checked')
				} else if (res.Budget_Type == 'category') {
					$('#edit_project').attr('checked', 'checked')
				}


			})
		}
		function delete_budget(data) {
			$('#delete_item').val(data)
		}

		function confirm_delete(data) {
			$.get('/delete_budget/' + data, function (res) {
				alert('Deleted Successfully')
				location.reload()
			})
		}
	</script>
	<script>
		function calculate_Revenve(data) {
			$('#edit_total_revenve').val(data.value)
		}
		function calculate_Expense(data) {
			$('#edit_total_expense').val(data.value)
			$('#edit_total_profit').val(Number($('#edit_total_revenve').val()) - Number(data.value))

		}
		function calculate_Amount(data) {
			$('#edit_tax_amount').val(data.value)
			$('#edit_budget_amount').val(Number($('#edit_total_profit').val()) - Number(data.value))

		}
	</script>
	<!-- /Edit Modal -->

	<!-- Delete Holiday Modal -->
	<div class="modal custom-modal fade" id="delete" role="dialog">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-body">
					<div class="form-header">
						<h3>Delete </h3>
						<p>Are you sure want to delete?</p>
					</div>
					<div class="modal-btn delete-action">
						<div class="row">
							<div class="col-6">
								<input name="delete_item" id="delete_item" type="hidden">
								<a href="javascript:void(0);" data-bs-dismiss="modal"
									class="btn btn-primary continue-btn"
									onclick="confirm_delete($('#delete_item').val())">Delete</a>
							</div>
							<div class="col-6">
								<a href="javascript:void(0);" data-bs-dismiss="modal"
									class="btn btn-primary cancel-btn">Cancel</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- /Delete Holiday Modal -->
</div>
<!-- /Page Wrapper -->

{% include "Layout/side_style.html" %}
{% include "Layout/bottom.html" %}